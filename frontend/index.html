<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="High-fidelity traffic simulation visualization with real-time SUMO integration. Digital twin visualization for urban crossroad intersections.">
    <meta name="keywords" content="traffic simulation, SUMO, digital twin, crossroad, visualization">
    <meta name="author" content="Traffic Simulation System">
    <title>üö¶ Traffic Digital Twin | Crossroad Simulation</title>

    <!-- Favicon -->
    <link rel="icon" href="favicon.ico" type="image/x-icon">

    <!-- Stylesheets -->
    <link rel="stylesheet" href="styles.css">

    <!-- Preload critical fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
</head>

<body>
    <!-- Sidebar Navigation -->
    <aside id="sidebar" role="complementary" aria-label="Simulation Controls">
        <button id="toggleSidebar" aria-label="Toggle sidebar">‚ò∞ Controls</button>
        <div id="sidebarContent">
            <!-- Zoom Control -->
            <div class="form-group">
                <label for="zoom_level">üîç Zoom Level</label>
                <input type="range" id="zoom_level" min="0.5" max="2" step="0.1" value="1"
                    aria-label="Zoom level control">
            </div>

            <!-- Node Configuration -->
            <div class="form-group">
                <label for="bft_n">üñ•Ô∏è Nodes</label>
                <input type="number" id="bft_n" value="4" min="1" max="20">
            </div>

            <div class="form-group">
                <label for="bft_m">‚ö†Ô∏è Byzantine Nodes</label>
                <input type="number" id="bft_m" value="1" min="0" max="10">
            </div>

            <!-- Fault Configuration -->
            <div class="form-group">
                <label for="bft_faulty_proposer">üî¥ Faulty Proposer</label>
                <input type="checkbox" id="bft_faulty_proposer">
            </div>

            <div class="form-group">
                <label for="bft_allow_tampering">üõ°Ô∏è Allow Tampering</label>
                <input type="checkbox" id="bft_allow_tampering">
            </div>

            <!-- Topology Selection -->
            <div class="form-group">
                <label for="topology">üåê Network Topology</label>
                <select id="topology">
                    <option value="full">Full Connection</option>
                    <option value="tree">N-ary Tree</option>
                    <option value="ring">Ring</option>
                    <option value="star">Star</option>
                </select>
            </div>

            <div class="form-group" id="n_value_group" style="display: none;">
                <label for="n_value">üå≥ N-ary Value</label>
                <input type="number" id="n_value" value="2" min="2">
            </div>

            <!-- Animation Speed -->
            <div class="form-group">
                <label for="animation_speed">‚ö° Animation Speed</label>
                <input type="range" id="animation_speed" min="1" max="60" step="1" value="30">
            </div>

            <!-- SUMO Connection -->
            <div class="form-group">
                <label for="sumo_url">üîó SUMO WebSocket</label>
                <input type="text" id="sumo_url" value="ws://localhost:8765" style="flex: 1;">
            </div>

            <!-- Action Buttons -->
            <button id="sumo_connect" type="button">
                üîå Connect SUMO
            </button>
            <button id="sumo_start" type="button">
                ‚ñ∂Ô∏è Start Simulation
            </button>

            <!-- Status Display -->
            <div id="sumo_status_text" class="status-line">
                ‚è≥ Disconnected
            </div>

            <button id="bft_exec" type="button">
                üöÄ Execute BFT
            </button>
        </div>
    </aside>

    <!-- Main Content Area -->
    <main id="main_container" role="main">
        <!-- Simulation Canvas -->
        <section id="animation_container" class="card" aria-label="Simulation visualization">
            <canvas id="bft_screen" width="600" height="600" role="img"
                aria-label="Traffic intersection simulation canvas"></canvas>
        </section>

        <!-- Results Panel -->
        <section id="results_container" class="card" aria-label="Simulation results">
            <!-- Consensus Visualization Panel -->
            <article id="consensus_panel" class="card">
                <h4>üîó Consensus Network</h4>
                <div id="consensus_controls">
                    <div class="form-group">
                        <label for="demo_mode">üé¨ Demo Mode</label>
                        <input type="checkbox" id="demo_mode">
                    </div>
                    <div class="consensus-stats">
                        <div class="stat-item">
                            <span class="stat-label">Nodes</span>
                            <span class="stat-value" id="active_nodes">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Messages</span>
                            <span class="stat-value" id="message_count">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Consensus</span>
                            <span class="stat-value" id="consensus_status">--</span>
                        </div>
                    </div>
                </div>
                <!-- State Legend -->
                <div id="state_legend">
                    <span class="legend-item"><span class="legend-dot" style="background: #6e7681;"></span>Idle</span>
                    <span class="legend-item"><span class="legend-dot"
                            style="background: #f0883e;"></span>Preparing</span>
                    <span class="legend-item"><span class="legend-dot"
                            style="background: #4ecdc4;"></span>Committing</span>
                    <span class="legend-item"><span class="legend-dot"
                            style="background: #2ea043;"></span>Committed</span>
                    <span class="legend-item"><span class="legend-dot" style="background: #f85149;"></span>Failed</span>
                </div>
            </article>

            <!-- Event Log Panel -->
            <article id="event_log_panel" class="card">
                <h4>üìã Event Log</h4>
                <div id="event_log_container">
                    <div id="event_log" aria-label="Consensus event log">
                        <div class="log-placeholder">Waiting for consensus events...</div>
                    </div>
                </div>
            </article>

            <!-- Analytics Panel -->
            <article id="analytics_panel" class="card">
                <h4>üìä Research Analytics</h4>

                <!-- Communication Range Control -->
                <div class="analytics-control">
                    <div class="form-group">
                        <label for="show_comm_range">üîç Show Comm Range</label>
                        <input type="checkbox" id="show_comm_range">
                    </div>
                    <div class="form-group range-slider">
                        <label>Range: <span id="comm_range_value">50</span>m</label>
                        <input type="range" id="comm_range" min="20" max="150" value="50">
                    </div>
                </div>

                <!-- Message Statistics Chart -->
                <div class="chart-container">
                    <div class="chart-title">Message Distribution</div>
                    <canvas id="message_chart" width="280" height="100"></canvas>
                </div>

                <!-- Node State Distribution -->
                <div class="chart-container">
                    <div class="chart-title">Node State Distribution</div>
                    <div id="state_distribution">
                        <div class="state-bar-container">
                            <div class="state-bar" id="bar_idle" style="background: #6e7681; width: 100%;"></div>
                            <div class="state-bar" id="bar_preparing" style="background: #f0883e; width: 0%;"></div>
                            <div class="state-bar" id="bar_committing" style="background: #4ecdc4; width: 0%;"></div>
                            <div class="state-bar" id="bar_committed" style="background: #2ea043; width: 0%;"></div>
                            <div class="state-bar" id="bar_failed" style="background: #f85149; width: 0%;"></div>
                        </div>
                        <div class="state-labels">
                            <span id="label_idle">Idle: 0</span>
                            <span id="label_preparing">Prep: 0</span>
                            <span id="label_committing">Comm: 0</span>
                            <span id="label_committed">Done: 0</span>
                        </div>
                    </div>
                </div>

                <!-- Network Activity Chart -->
                <div class="chart-container">
                    <div class="chart-title">Network Activity (msg/s)</div>
                    <canvas id="activity_chart" width="280" height="80"></canvas>
                </div>

                <!-- Consensus Metrics -->
                <div class="metrics-grid">
                    <div class="metric-item">
                        <span class="metric-value" id="avg_latency">--</span>
                        <span class="metric-label">Decision Latency (ms)</span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-value" id="topology_score">--</span>
                        <span class="metric-label">Topo Stability</span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-value" id="throughput_gain">--</span>
                        <span class="metric-label">Throughput Gain</span>
                    </div>
                </div>
            </article>

            <!-- SUMO Panel -->
            <article id="sumo_panel" class="card">
                <h4>SUMO Live Stream</h4>
                <div id="sumo_status">Waiting for connection‚Ä¶</div>
                <div id="sumo_last_update" class="status-line"></div>
                <canvas id="sumo_chart" width="480" height="180" role="img" aria-label="Speed chart"></canvas>
                <pre id="sumo_preview" aria-label="Vehicle data preview"></pre>
            </article>
        </section>
    </main>

    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script type="module" src="scripts.js"></script>
</body>

</html>